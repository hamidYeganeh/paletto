<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Users Module Demo</title>
    <style>
      :root {
        color-scheme: light dark;
        font-family:
          "SF Pro Text",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          sans-serif;
        background:
          radial-gradient(120% 120% at 15% 20%, #1c2733 0, #0e1116 35%),
          radial-gradient(120% 120% at 85% 10%, #2a1f3d 0, #0e1116 35%),
          radial-gradient(140% 140% at 50% 120%, #0f1f2d 0, #0e1116 40%);
        color: #f4f7fb;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 32px;
      }

      .grid {
        display: grid;
        gap: 18px;
        width: min(960px, 100%);
      }

      .card {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(10px);
        border-radius: 18px;
        padding: 24px;
        box-shadow: 0 18px 80px rgba(0, 0, 0, 0.35);
      }

      h1 {
        margin: 0 0 6px 0;
        letter-spacing: -0.02em;
        font-size: 28px;
      }

      h2 {
        margin: 0 0 6px 0;
        font-size: 18px;
      }

      p {
        margin: 0 0 18px 0;
        color: #c8d1dc;
      }

      form {
        display: grid;
        gap: 14px;
      }

      label {
        font-weight: 600;
        color: #e3e9f1;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      input,
      textarea {
        padding: 12px 14px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(0, 0, 0, 0.25);
        color: #f4f7fb;
        font-size: 15px;
        transition:
          border-color 0.2s ease,
          background 0.2s ease;
      }

      textarea {
        min-height: 90px;
        resize: vertical;
      }

      input:focus,
      textarea:focus {
        outline: none;
        border-color: #7dd1ff;
        background: rgba(0, 0, 0, 0.35);
      }

      button {
        padding: 12px 15px;
        border: none;
        border-radius: 12px;
        font-weight: 700;
        letter-spacing: 0.01em;
        cursor: pointer;
        background: linear-gradient(120deg, #66e0ff, #7a7cff, #ff6b9d);
        color: #0b0f16;
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);
        transition:
          transform 0.2s ease,
          box-shadow 0.2s ease;
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 45px rgba(0, 0, 0, 0.45);
      }

      .muted {
        color: #a7b3c4;
        font-size: 14px;
      }

      .panel {
        margin-top: 12px;
        padding: 12px;
        border-radius: 12px;
        background: rgba(0, 0, 0, 0.35);
        border: 1px solid rgba(255, 255, 255, 0.07);
      }

      pre {
        margin: 0;
        white-space: pre-wrap;
        word-break: break-word;
        font-family: "SF Mono", "JetBrains Mono", Menlo, monospace;
        color: #dbe9ff;
      }

      .columns {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 18px;
      }
    </style>
  </head>
  <body>
    <section class="grid">
      <div class="card">
        <h1>Users Module Demo</h1>
        <p>
          Exercise the authenticated endpoints:
          <code>GET /users/profile/get</code> and
          <code>PATCH /users/profile/update</code>. You need a Bearer token from
          the Auth demo (sign in first and paste the token here).
        </p>

        <form id="base-form">
          <label>
            API base URL
            <input
              id="base-url"
              name="baseUrl"
              type="url"
              value="http://localhost:5000"
              autocomplete="off"
              required
            />
          </label>
          <label>
            Bearer token
            <input
              id="token"
              name="token"
              type="text"
              placeholder="Paste token from /auth/sign-in"
              autocomplete="off"
              required
            />
            <span class="muted"
              >You can sign in using <code>auth-demo.html</code> to get a
              token.</span
            >
          </label>
        </form>
      </div>

      <div class="columns">
        <div class="card">
          <h2>Get profile</h2>
          <p class="muted">GET /users/profile/get</p>
          <button id="get-profile">Fetch profile</button>
          <div class="panel">
            <div class="muted">Curl</div>
            <pre id="curl-get"></pre>
          </div>
          <div class="panel">
            <div class="muted">Response</div>
            <pre id="resp-get">Waiting...</pre>
          </div>
        </div>

        <div class="card">
          <h2>Update profile</h2>
          <p class="muted">PATCH /users/profile/update</p>
          <form id="update-form">
            <label>
              Name
              <input
                id="name"
                name="name"
                type="text"
                placeholder="Jane Doe"
              />
            </label>
            <label>
              Bio
              <textarea
                id="bio"
                name="bio"
                placeholder="Something about you (optional)"
              ></textarea>
            </label>
            <button type="submit">Update profile</button>
          </form>
          <div class="panel">
            <div class="muted">Curl</div>
            <pre id="curl-update"></pre>
          </div>
          <div class="panel">
            <div class="muted">Response</div>
            <pre id="resp-update">Waiting...</pre>
          </div>
        </div>

        <div class="card">
          <h2>Create artist profile</h2>
          <p class="muted">POST /artists/create</p>
          <form id="artist-create-form">
            <label>
              Display name
              <input
                id="artist-display-name"
                name="displayName"
                type="text"
                placeholder="Painter Jane"
              />
            </label>
            <label>
              Techniques (comma-separated ObjectIds)
              <input
                id="artist-techniques"
                name="techniques"
                type="text"
                placeholder="6512abc..., 6512def..."
              />
            </label>
            <label>
              Styles (comma-separated ObjectIds)
              <input
                id="artist-styles"
                name="styles"
                type="text"
                placeholder="6512fed..., 6512cba..."
              />
            </label>
            <button type="submit">Create artist</button>
          </form>
          <div class="panel">
            <div class="muted">Curl</div>
            <pre id="curl-artist-create"></pre>
          </div>
          <div class="panel">
            <div class="muted">Response</div>
            <pre id="resp-artist-create">Waiting...</pre>
          </div>
        </div>

        <div class="card">
          <h2>Update artist profile</h2>
          <p class="muted">PATCH /artists/update</p>
          <form id="artist-update-form">
            <label>
              Display name
              <input
                id="artist-update-display-name"
                name="displayName"
                type="text"
                placeholder="Painter Jane"
              />
            </label>
            <label>
              Techniques (comma-separated ObjectIds)
              <input
                id="artist-update-techniques"
                name="techniques"
                type="text"
                placeholder="6512abc..., 6512def..."
              />
            </label>
            <label>
              Styles (comma-separated ObjectIds)
              <input
                id="artist-update-styles"
                name="styles"
                type="text"
                placeholder="6512fed..., 6512cba..."
              />
            </label>
            <button type="submit">Update artist</button>
          </form>
          <div class="panel">
            <div class="muted">Curl</div>
            <pre id="curl-artist-update"></pre>
          </div>
          <div class="panel">
            <div class="muted">Response</div>
            <pre id="resp-artist-update">Waiting...</pre>
          </div>
        </div>
      </div>
    </section>

    <script>
      const baseUrlInput = document.getElementById("base-url");
      const tokenInput = document.getElementById("token");
      const getBtn = document.getElementById("get-profile");
      const curlGetEl = document.getElementById("curl-get");
      const respGetEl = document.getElementById("resp-get");

      const updateForm = document.getElementById("update-form");
      const nameInput = document.getElementById("name");
      const bioInput = document.getElementById("bio");
      const curlUpdateEl = document.getElementById("curl-update");
      const respUpdateEl = document.getElementById("resp-update");

      const artistCreateForm = document.getElementById("artist-create-form");
      const artistCreateDisplayNameInput =
        document.getElementById("artist-display-name");
      const artistCreateTechniquesInput =
        document.getElementById("artist-techniques");
      const artistCreateStylesInput =
        document.getElementById("artist-styles");
      const curlArtistCreateEl = document.getElementById("curl-artist-create");
      const respArtistCreateEl = document.getElementById("resp-artist-create");

      const artistUpdateForm = document.getElementById("artist-update-form");
      const artistUpdateDisplayNameInput = document.getElementById(
        "artist-update-display-name"
      );
      const artistUpdateTechniquesInput = document.getElementById(
        "artist-update-techniques"
      );
      const artistUpdateStylesInput =
        document.getElementById("artist-update-styles");
      const curlArtistUpdateEl = document.getElementById("curl-artist-update");
      const respArtistUpdateEl = document.getElementById("resp-artist-update");

      const cleanBase = () => baseUrlInput.value.replace(/\/+$/, "");

      const parseList = (value) =>
        (value || "")
          .split(",")
          .map((v) => v.trim())
          .filter(Boolean);

      const renderCurlGet = () => {
        const base = cleanBase();
        const token = tokenInput.value || "<TOKEN>";
        curlGetEl.textContent = [
          "curl",
          "-X GET",
          `"${base}/users/profile/get"`,
          '-H "Authorization: Bearer ' + token + '"',
        ].join(" ");
      };

      const renderCurlUpdate = () => {
        const base = cleanBase();
        const token = tokenInput.value || "<TOKEN>";
        const body = {
          name: nameInput.value || "Jane Doe",
          bio: bioInput.value || "",
        };
        curlUpdateEl.textContent = [
          "curl",
          "-X PATCH",
          `"${base}/users/profile/update"`,
          '-H "Authorization: Bearer ' + token + '"',
          '-H "Content-Type: application/json"',
          `-d '${JSON.stringify(body)}'`,
        ].join(" ");
      };

      const renderCurlArtistCreate = () => {
        const base = cleanBase();
        const token = tokenInput.value || "<TOKEN>";
        const body = {};

        if (artistCreateDisplayNameInput.value.trim()) {
          body.displayName = artistCreateDisplayNameInput.value.trim();
        }
        const techniques = parseList(artistCreateTechniquesInput.value);
        if (techniques.length) {
          body.techniques = techniques;
        }
        const styles = parseList(artistCreateStylesInput.value);
        if (styles.length) {
          body.styles = styles;
        }

        curlArtistCreateEl.textContent = [
          "curl",
          "-X POST",
          `"${base}/artists/create"`,
          '-H "Authorization: Bearer ' + token + '"',
          '-H "Content-Type: application/json"',
          `-d '${JSON.stringify(body)}'`,
        ].join(" ");
      };

      const renderCurlArtistUpdate = () => {
        const base = cleanBase();
        const token = tokenInput.value || "<TOKEN>";
        const body = {};

        if (artistUpdateDisplayNameInput.value.trim()) {
          body.displayName = artistUpdateDisplayNameInput.value.trim();
        }
        const techniques = parseList(artistUpdateTechniquesInput.value);
        if (techniques.length) {
          body.techniques = techniques;
        }
        const styles = parseList(artistUpdateStylesInput.value);
        if (styles.length) {
          body.styles = styles;
        }

        curlArtistUpdateEl.textContent = [
          "curl",
          "-X PATCH",
          `"${base}/artists/update"`,
          '-H "Authorization: Bearer ' + token + '"',
          '-H "Content-Type: application/json"',
          `-d '${JSON.stringify(body)}'`,
        ].join(" ");
      };

      baseUrlInput.addEventListener("input", () => {
        renderCurlGet();
        renderCurlUpdate();
        renderCurlArtistCreate();
        renderCurlArtistUpdate();
      });
      tokenInput.addEventListener("input", () => {
        renderCurlGet();
        renderCurlUpdate();
        renderCurlArtistCreate();
        renderCurlArtistUpdate();
      });
      updateForm.addEventListener("input", renderCurlUpdate);
      artistCreateForm.addEventListener("input", renderCurlArtistCreate);
      artistUpdateForm.addEventListener("input", renderCurlArtistUpdate);

      renderCurlGet();
      renderCurlUpdate();
      renderCurlArtistCreate();
      renderCurlArtistUpdate();

      getBtn.addEventListener("click", async () => {
        respGetEl.textContent = "Fetching profile...";
        try {
          const res = await fetch(`${cleanBase()}/users/profile/get`, {
            headers: {
              Authorization: `Bearer ${tokenInput.value}`,
            },
          });
          const text = await res.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch (err) {
            throw new Error(`Unexpected JSON response: ${text}`);
          }
          if (!res.ok) {
            throw new Error(data?.message || res.statusText);
          }
          respGetEl.textContent = JSON.stringify(data, null, 2);
        } catch (err) {
          respGetEl.textContent = `Error: ${err.message}`;
        }
      });

      updateForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        respUpdateEl.textContent = "Updating profile...";
        const payload = {
          name: !!nameInput.value ? nameInput.value : undefined,
          bio: !!bioInput.value ? bioInput.value : undefined,
        };
        try {
          const res = await fetch(`${cleanBase()}/users/profile/update`, {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${tokenInput.value}`,
            },
            body: JSON.stringify(payload),
          });
          const text = await res.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch (err) {
            throw new Error(`Unexpected JSON response: ${text}`);
          }
          if (!res.ok) {
            throw new Error(data?.message || res.statusText);
          }
          respUpdateEl.textContent = JSON.stringify(data, null, 2);
        } catch (err) {
          respUpdateEl.textContent = `Error: ${err.message}`;
        }
      });

      artistCreateForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        respArtistCreateEl.textContent = "Creating artist profile...";
        const payload = {};

        if (artistCreateDisplayNameInput.value.trim()) {
          payload.displayName = artistCreateDisplayNameInput.value.trim();
        }
        const techniques = parseList(artistCreateTechniquesInput.value);
        if (techniques.length) {
          payload.techniques = techniques;
        }
        const styles = parseList(artistCreateStylesInput.value);
        if (styles.length) {
          payload.styles = styles;
        }

        try {
          const res = await fetch(`${cleanBase()}/artists/create`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${tokenInput.value}`,
            },
            body: JSON.stringify(payload),
          });
          const text = await res.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch (err) {
            throw new Error(`Unexpected JSON response: ${text}`);
          }
          if (!res.ok) {
            throw new Error(data?.message || res.statusText);
          }
          respArtistCreateEl.textContent = JSON.stringify(data, null, 2);
        } catch (err) {
          respArtistCreateEl.textContent = `Error: ${err.message}`;
        }
      });

      artistUpdateForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        respArtistUpdateEl.textContent = "Updating artist profile...";
        const payload = {};

        if (artistUpdateDisplayNameInput.value.trim()) {
          payload.displayName = artistUpdateDisplayNameInput.value.trim();
        }
        const techniques = parseList(artistUpdateTechniquesInput.value);
        if (techniques.length) {
          payload.techniques = techniques;
        }
        const styles = parseList(artistUpdateStylesInput.value);
        if (styles.length) {
          payload.styles = styles;
        }

        try {
          const res = await fetch(`${cleanBase()}/artists/update`, {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${tokenInput.value}`,
            },
            body: JSON.stringify(payload),
          });
          const text = await res.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch (err) {
            throw new Error(`Unexpected JSON response: ${text}`);
          }
          if (!res.ok) {
            throw new Error(data?.message || res.statusText);
          }
          respArtistUpdateEl.textContent = JSON.stringify(data, null, 2);
        } catch (err) {
          respArtistUpdateEl.textContent = `Error: ${err.message}`;
        }
      });
    </script>
  </body>
</html>
